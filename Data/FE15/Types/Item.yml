---
ItemFile:
  size: 0
  fields:
    - id: item_mod_list
      type: record
      typename: ModList
      format: inline
    - id: item_table
      type: record
      typename: ItemTableHeader
      format: inline
    - id: forge_mod_list
      type: record
      typename: ModList
      format: inline
    - id: forge_table
      type: record
      typename: ItemForgeTableHeader
      format: inline
    - id: item_evolution_mod_list
      type: record
      typename: ModList
      format:
        label_append:
          label: MOD_進化
    - id: item_evolution_table
      type: record
      typename: ItemEvolutionTableHeader
      format:
        label_append:
          label: 進化
    - id: item_categories_mod_list
      type: record
      typename: ModList
      format:
        label_append:
          label: MOD_カテゴリ
    - id: item_categories_table
      type: record
      typename: ItemCategoryTableHeader
      format:
        label_append:
          label: カテゴリ
    - id: sheet_list
      type: record
      typename: SheetList
      format:
        label_append:
          label: SHEET_LIST


ItemTableHeader:
  size: 8
  fields:
    - id: label
      type: label
    - id: name
      type: string
    - id: count
      type: int
      format:
        type: u16
    - id: unknown
      type: bytes
      length: 2
    - id: table
      type: record
      typename: ItemTable
      format: inline_pointer

ItemTable:
  size: 0
  node:
    id: items
    name: Items
  fields:
    - id: label
      type: label
      index: 0
    - id: items
      type: list
      typename: Item
      table: items
      format:
        type: indirect
        index: -2
        offset: 4
        format:
          type: u16

Item:
  size: 224
  key: iid
  display: name
  icon: item_big
  fields:
    - id: label
      type: label
      generate_from: iid
    - id: iid
      type: string
    - id: name
      type: message
      paths: [m/Item.bin.lz, m/Name.bin.lz]
    - id: description
      type: message
      paths: [m/Item.bin.lz, m/Name.bin.lz]
    - id: tut_description
      type: message
      paths: [m/Tutorial.bin.lz]
    - id: pid
      type: string
    - id: rid
      type: string
    - id: eid
      type: string
    - id: new_iid
      type: string
    - id: com_fld
      type: string
    - id: item_type
      type: int
      format:
        type: u8
    - id: effect
      type: int
      format:
        type: u8
    - id: icon
      type: int
      format:
        type: u8
    - id: sort
      type: int
      format:
        type: u8
    - id: age_restriction
      type: int
      format:
        type: u8
    - id: rarity
      type: int
      format:
        type: u8
    - id: chapter_restriction
      type: int
      format:
        type: u8
    - id: visit_restriction
      type: int
      format:
        type: u8
    - id: food_taste
      type: int
      format:
        type: u8
    - id: hp_recovery
      type: int
      format:
        type: u8
    - id: fatigue_recovery
      type: int
      format:
        type: u8
    - id: experience
      type: int
      format:
        type: u8
    - id: might
      type: int
      format:
        type: i8
    - id: weight
      type: int
      format:
        type: i8
    - id: min_range
      type: int
      format:
        type: i8
    - id: max_range
      type: int
      format:
        type: i8
    - id: hit
      type: int
      format:
        type: i16
    - id: avoid
      type: int
      format:
        type: i16
    - id: crit
      type: int
      format:
        type: i16
    - id: crit_evade
      type: int
      format:
        type: i16
    - id: equip_buff
      type: bytes
      length: 8
    - id: consume_buff
      type: bytes
      length: 8
    - id: unknown_stats
      type: bytes
      length: 8
    # These ARE references, but some items reference skills
    # that don't actually exist. I don't want to destroy these
    # references entirely, so these will be left as strings for now.
    - id: passive_effect_1
      type: string
    - id: passive_effect_2
      type: string
    - id: passive_effect_3
      type: string
    - id: passive_effect_4
      type: string
    - id: passive_skill_1
      type: string
    - id: passive_skill_2
      type: string
    - id: passive_skill_3
      type: string
    - id: passive_skill_4
      type: string
    - id: learned_skill_1
      type: string
    - id: learned_skill_2
      type: string
    - id: learned_skill_3
      type: string
    - id: learned_skill_4
      type: string
    - id: value
      type: int
      format:
        type: i16
    - id: staff_type
      type: int
      format:
        type: u8
    - id: staff_exp
      type: int
      format:
        type: u8
    - id: spell_hp
      type: int
      format:
        type: i8
    - id: reward
      type: int
      format:
        type: i8
    - id: quantity
      type: int
      format:
        type: i8
    - id: effective_reserved
      type: int
      format:
        type: u8
    - id: flags
      type: bytes
      length: 4
    - id: model
      type: string
    - id: texture
      type: string
    - id: x_position
      type: float
    - id: y_position
      type: float
    - id: z_position
      type: float
    - id: x_scale
      type: float
    - id: y_scale
      type: float
    - id: z_scale
      type: float
    - id: appear_sound
      type: string
    - id: drop_effect
      type: string
    - id: place_effect
      type: string
    - id: pick_up_effect
      type: string
    - id: reserved
      type: bytes
      length: 32

ItemForgeTableHeader:
  size: 8
  fields:
    - id: label
      type: label
    - id: name
      type: string
    - id: count
      type: int
      format:
        type: u16
    - id: unknown
      type: bytes
      length: 2
    - id: table
      type: record
      typename: ItemForgeTable
      format: inline_pointer

ItemForgeTable:
  size: 0
  fields:
    - id: label
      type: label
      index: 0
    - id: forge_entries
      type: list
      typename: ItemForge
      format:
        type: indirect
        index: -2
        offset: 4
        format:
          type: u16

ItemForge:
  size: 12
  key: rid
  fields:
    - id: label
      type: label
    - id: rid
      type: string
    - id: count
      type: int
      format:
        type: u32
    - id: item_forge_data
      type: record
      typename: ItemForgeDataTable
      format: pointer

ItemForgeDataTable:
  size: 0
  fields:
    - id: items
      type: list
      typename: ItemForgeDataItem
      format:
        type: indirect
        index: -2
        offset: 4
        format:
          type: u32

ItemForgeDataItem:
  size: 10
  fields:
    - id: silver_cost
      type: int
      format:
        type: i16
    - id: gold_cost
      type: int
      format:
        type: i16
    - id: might
      type: int
      format:
        type: i8
    - id: weight
      type: int
      format:
        type: i8
    - id: hit
      type: int
      format:
        type: i8
    - id: crit
      type: int
      format:
        type: i8
    - id: unused
      type: bytes
      length: 2

ItemEvolutionTableHeader:
  size: 8
  fields:
    - id: label
      type: label
    - id: name
      type: string
    - id: count
      type: int
      format:
        type: u16
    - id: unknown
      type: bytes
      length: 2
    - id: table
      type: record
      typename: ItemEvolutionTable
      format: inline_pointer

ItemEvolutionTable:
  size: 0
  fields:
    - id: label
      type: label
      index: 0
    - id: item_evolutions
      type: list
      typename: ItemEvolution
      format:
        type: indirect
        index: -2
        offset: 4
        format:
          type: u16

ItemEvolution:
  size: 12
  key: eid
  fields:
    - id: label
      type: label
    - id: eid
      type: string
    - id: count
      type: int
      format:
        type: u32
    - id: item_evolution_data
      type: record
      typename: ItemEvolutionDataTable
      format: pointer

ItemEvolutionDataTable:
  size: 0
  fields:
    - id: items
      type: list
      typename: ItemEvolutionDataItem
      format:
        type: indirect
        index: -2
        offset: 4
        format:
          type: u32

ItemEvolutionDataItem:
  size: 12
  key: iid
  fields:
    - id: iid
      type: string
    - id: data
      type: bytes
      length: 8

ItemCategoryTableHeader:
  size: 8
  fields:
    - id: label
      type: label
    - id: name
      type: string
    - id: count
      type: int
      format:
        type: u16
    - id: unknown
      type: bytes
      length: 2
    - id: table
      type: record
      typename: ItemCategoryTable
      format: inline_pointer

ItemCategoryTable:
  size: 0
  fields:
    - id: label
      type: label
      index: 0
    - id: categories
      type: list
      typename: ItemCategory
      format:
        type: indirect
        index: -2
        offset: 4
        format:
          type: u16

ItemCategory:
  size: 8
  key: name
  fields:
    - id: label
      type: label
      generate_from: name
    - id: name
      type: string
    - id: data
      type: bytes
      length: 4